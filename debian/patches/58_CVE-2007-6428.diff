Index: xorg-server/Xext/cup.c
===================================================================
--- xorg-server.orig/Xext/cup.c	2008-01-06 17:19:46.000000000 +0100
+++ xorg-server/Xext/cup.c	2008-01-06 17:20:07.000000000 +0100
@@ -196,6 +196,9 @@
 
     REQUEST_SIZE_MATCH (xXcupGetReservedColormapEntriesReq);
 
+    if (stuff->screen >= screenInfo.numScreens)
+	return BadValue;
+
 #ifndef HAVE_SPECIAL_DESKTOP_COLORS
     citems[CUP_BLACK_PIXEL].pixel = 
 	screenInfo.screens[stuff->screen]->blackPixel;
